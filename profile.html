<!DOCTYPE html>  <html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>User Profile</title>  
<meta name="viewport" content="width=device-width, initial-scale=1">  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>  
<style>  
/* --- 1. General Styles --- */  
body { margin: 0; font-family: Arial, sans-serif; background: #1E2230; color: #fff; overflow-x: hidden; }  
button { cursor: pointer; }  
/* --- 2. Profile Page Styles --- */  
.top-nav { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #1E2230; }  
.top-nav i { font-size: 20px; color: #fff; cursor: pointer; }  
.top-nav-avatar { width: 30px; height: 30px; border-radius: 50%; background: #ff9f43; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; color: #1E2230; }  
.header { background: linear-gradient(90deg, #ff9f43, #feca57); padding: 20px; padding-top: 5px; margin-bottom: 20px; }  
.profile-info { display: flex; align-items: center; margin-bottom: 15px; }  
.avatar { width: 60px; height: 60px; border-radius: 50%; background: #2c2f4a; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: bold; margin-right: 15px; color: #fff; }  
.username-details { line-height: 1.3; }  
.username-details strong { font-size: 18px; display: block; }  
.member-tag { background: #1dd1a1; color: #1E2230; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-left: 10px; vertical-align: top; }  
.web-info { background: rgba(0, 0, 0, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; }  
.web-url-label { color: #fff; font-size: 12px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }  
.web-url-value { background: #1e2230; color: #aaa; padding: 8px; border-radius: 5px; font-size: 14px; word-break: break-all; min-height: 20px; cursor: pointer; border: 1px dashed #555; }  
.stats-container { display: flex; justify-content: space-around; text-align: center; margin-top: 15px; }  
.stat-box { background: #2c2f4a; padding: 10px; border-radius: 8px; width: 45%; display: flex; flex-direction: column; justify-content: center; align-items: center; }  
.stat-box .label { color: #aaa; font-size: 12px; }  
.stat-box .value { font-size: 20px; font-weight: bold; margin-top: 5px; }  
.alert-card { background: #4a2c2c; margin: 20px; padding: 15px; border-radius: 10px; text-align: center; }  
.alert-icon { color: #ff9f43; font-size: 24px; margin-bottom: 10px; }  
.link-btn { background: #1dd1a1; color: #1E2230; border: none; width: 100%; padding: 12px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; }  
.menu-item { background: #2c2f4a; margin: 0 20px 10px 20px; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }  
.menu-item i { margin-right: 10px; color: #ff9f43; }  
.menu-item-text { flex-grow: 1; font-size: 16px; }  
.menu-item-arrow { color: #aaa; }  
.logout-btn-container { margin: 20px; }  
.logout-btn { background: #2c2f4a; color: #fff; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 16px; cursor: pointer; text-align: left; display: flex; align-items: center; }  

#themes-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1f2437; z-index: 1000; display: none; overflow-y: auto; }  
.modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 15px; background: #1f2437; position: sticky; top: 0; z-index: 1010; }  
.modal-header h2 { margin: 0; font-size: 18px; font-weight: bold; letter-spacing: 0.5px; }  
.modal-close-btn { background: none; border: none; color: #fff; font-size: 28px; cursor: pointer; padding: 0 5px; opacity: 0.7; }  
.theme-list { padding: 0 10px; }  
.theme-item { display: flex; align-items: center; justify-content: space-between; background: #2a304a; padding: 15px; margin-bottom: 10px; border-radius: 8px; }  
.theme-info { display: flex; align-items: center; }  
.theme-icon { font-size: 20px; color: #2ecc71; margin-right: 15px; }  
.text-content { display: flex; flex-direction: column; text-align: left; }  
.theme-name { font-size: 16px; font-weight: bold; margin-bottom: 2px; }  
.status { font-size: 12px; color: #2ecc71; display: flex; align-items: center; }  
.status::before { content: 'â€¢'; font-size: 18px; line-height: 0; margin-right: 4px; }  
.use-btn { padding: 10px 20px; border-radius: 8px; border: none; background: #8e44ad; color: #fff; font-size: 14px; font-weight: bold; text-transform: uppercase; min-width: 80px; transition: background 0.3s; cursor: pointer; }  
.use-btn.active-theme { background: #2ecc71 !important; color: #1E2230; cursor: default; opacity: 1; }  
</style>  
</head>  
<body>  

<div id="profile-content">  
    <div class="top-nav">  
        <i class="fas fa-bars"></i>  
        <div>  
            <i class="fas fa-search" style="margin-right: 15px;"></i>  
            <i class="fas fa-sun" style="margin-right: 15px;"></i>  
            <i class="fas fa-th-large" style="margin-right: 15px;"></i>  
            <i class="fas fa-comment-dots" style="margin-right: 15px;"></i>  
            <div class="top-nav-avatar" id="top-nav-avatar">A</div>  
        </div>  
    </div>  

    <div class="header">  
        <div class="profile-info">  
            <div class="avatar" id="avatar">ðŸ‘¤</div>  
            <div class="username-details">  
                <strong id="username">Checking Auth...</strong>  
                <span id="email" style="font-size: 14px; color: rgba(255, 255, 255, 0.8);">...</span>  
            </div>  
            <span class="member-tag">MEMBER</span>  
        </div>  

        <div class="web-info">  
            <div class="web-url-label">YOUR WEB URL (CLICK TO COPY)</div>  
            <div class="web-url-value" id="web-url-value">...</div>  
        </div>  

        <div class="stats-container">  
            <div class="stat-box">  
                <div class="label"><i class="fas fa-star"></i> RANK</div>  
                <div class="value">#285</div>  
            </div>  
            <div class="stat-box">  
                <div class="label"><i class="fas fa-trophy"></i> RESULTS</div>  
                <div class="value">0</div>  
            </div>  
        </div>  
    </div>  

    <div class="alert-card">  
        <div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div>  
        link your telegram account before using the web  
        <button class="link-btn">LINK</button>  
    </div>  

    <div class="menu-item">  
        <div class="menu-item-text"><i class="fas fa-cog"></i> ACCOUNT SETTINGS</div>  
        <div class="menu-item-arrow"><i class="fas fa-chevron-right"></i></div>  
    </div>  

    <div class="menu-item" onclick="showThemesModal()">  
        <div class="menu-item-text"><i class="fas fa-palette"></i> THEMES & DEMOS</div>  
        <div class="menu-item-arrow"><i class="fas fa-chevron-right"></i></div>  
    </div>  

    <div class="menu-item">  
        <div class="menu-item-text"><i class="fas fa-user-circle"></i> PROFILE SETTINGS</div>  
        <div class="menu-item-arrow"><i class="fas fa-chevron-right"></i></div>  
    </div>  

    <div class="logout-btn-container">  
        <button class="logout-btn" onclick="logout()">  
            <i class="fas fa-sign-out-alt" style="margin-right: 10px;"></i>  
            LOGOUT  
        </button>  
    </div>  
</div>  

<div id="themes-modal">  
    <div class="modal-header">  
        <h2>THEMES & DEMOS</h2>  
        <button class="modal-close-btn" onclick="hideThemesModal()">&times;</button>  
    </div>  
    <div class="theme-list">  
        <div class="theme-item"><div class="theme-info"><span class="theme-icon">&#x27A4;</span><div class="text-content"><div class="theme-name">New Event 1</div><div class="status">ONLINE</div></div></div><button class="use-btn" data-theme="event1" data-url="https://temporasms.com/buy-number" onclick="useTheme(this)">USE</button></div>  
        <div class="theme-item"><div class="theme-info"><span class="theme-icon">&#x27A4;</span><div class="text-content"><div class="theme-name">New Event 2</div><div class="status">ONLINE</div></div></div><button class="use-btn" data-theme="event2" data-url="https://smsnum.org/numbers/" onclick="useTheme(this)">USE</button></div>  
        <div class="theme-item"><div class="theme-info"><span class="theme-icon">&#x27A4;</span><div class="text-content"><div class="theme-name">New Event 3</div><div class="status">ONLINE</div></div></div><button class="use-btn" data-theme="event3" data-url="theme.html" onclick="useTheme(this)">USE</button></div>  
        <div class="theme-item"><div class="theme-info"><span class="theme-icon">&#x27A4;</span><div class="text-content"><div class="theme-name">New Event 4</div><div class="status">ONLINE</div></div></div><button class="use-btn" data-theme="event4" data-url="https://example.com/theme4?user=[UID]" onclick="useTheme(this)">USE</button></div>  
    </div>  
</div>

<script>  
const firebaseConfig = {  
    apiKey: "AIzaSyBY4tPdcDfl0C-FRiP3L52PA2WctlziUtM",  
    authDomain: "flowwebsff.firebaseapp.com",  
    projectId: "flowwebsff"  
};  
firebase.initializeApp(firebaseConfig);  
const auth = firebase.auth();  
const db = firebase.firestore();  

// âœ… FORCE PERSISTENCE IMMEDIATELY
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

const BASE_DOMAIN = "https://flowownerffwebontg.github.io/WEB2/profile.html?uid=";
let currentUserUID = ""; 

function updateUrlDisplay() {  
    const el = document.getElementById('web-url-value');  
    if (el && currentUserUID) el.innerText = BASE_DOMAIN + currentUserUID;  
}  

function logout(){  
    auth.signOut().then(()=>{ window.location.href = "index.html"; });  
}  
  
function showThemesModal() { document.getElementById('themes-modal').style.display = 'block'; }  
function hideThemesModal() { document.getElementById('themes-modal').style.display = 'none'; }  

function useTheme(btn){  
    const themeId = btn.getAttribute('data-theme');  
    const customUrl = btn.getAttribute('data-url');  
    const user = auth.currentUser;  
    if(!user) return;  

    document.querySelectorAll(".use-btn").forEach(b=>{ b.classList.remove("active-theme"); b.innerText="USE"; b.disabled = false; });  
    btn.classList.add("active-theme"); btn.innerText="IN USE"; btn.disabled = true;  
    db.collection("users").doc(user.uid).set({ activeThemeId: themeId, activeThemeUrl: customUrl }, { merge: true });
}  
  
// âœ… ANTI-LOGOUT GUARD: Jab tak user pakka logout na ho, tab tak index par nahi bhejein
auth.onAuthStateChanged(user=>{  
    if(user){  
        currentUserUID = user.uid; 
        updateUrlDisplay(); 
        let name = user.displayName || user.email.split('@')[0];  
        document.getElementById("username").innerText = name;  
        document.getElementById("email").innerText = user.email;  
        document.getElementById("avatar").innerText = name.charAt(0).toUpperCase();  
        document.getElementById("top-nav-avatar").innerText = name.charAt(0).toUpperCase();  

        db.collection("users").doc(user.uid).get().then(doc => {  
            if(doc.exists && doc.data().activeThemeId){  
                const savedId = doc.data().activeThemeId;  
                document.querySelectorAll(".use-btn").forEach(b => {  
                    if(b.getAttribute('data-theme') === savedId){  
                        b.classList.add("active-theme"); b.innerText = "IN USE"; b.disabled = true;  
                    }
                });  
            }  
        });  
    } else {  
        // âš ï¸ Agar aap login page se yahan aaye hain aur session load hone mein time le raha hai,
        // toh ye 2 second wait karega. Agar user bilkul nahi hai, tabhi index.html par bhejega.
        setTimeout(() => {
            if(!auth.currentUser) { window.location.href = "index.html"; }
        }, 2000);
    }  
});  

document.getElementById('web-url-value').addEventListener('click', () => {
    navigator.clipboard.writeText(document.getElementById('web-url-value').innerText);
    alert("Copied!");
});

// Redirect check
const uidUrl = new URLSearchParams(window.location.search).get("uid");
if (uidUrl) {
    db.collection("users").doc(uidUrl).get().then(doc => {
        if (doc.exists && doc.data().activeThemeUrl) window.location.href = doc.data().activeThemeUrl;
    });
}
</script>  
</body>  
</html>
